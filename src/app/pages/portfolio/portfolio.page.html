<div class="portfolio-container">
  <!-- Admin controls -->
  @if (isAdmin()) {
    <div class="admin-bar">
      <span>Modo Admin</span>
      <button class="logout-btn" (click)="logout()">Cerrar Sesi√≥n</button>
    </div>
  }

  <div class="grid-layout">
    <!-- Section 3: Identity - Left sidebar (spans both rows) -->
    <section class="section section-identity glass-section">
      <app-identity-panel
        [currentExperience]="currentExperience()"
        [currentStudy]="currentStudy()"
        [location]="location()"
        (contactClick)="goToContact()"
      />
    </section>

    <!-- Section 4: Navigation - Top bar -->
    <section class="section section-nav glass-section">
      <app-nav-bar
        [isAdmin]="isAdmin()"
        (filterChange)="onFilterChange($event)"
        (searchChange)="onSearchChange($event)"
        (contactClick)="goToContact()"
      />
    </section>

    <!-- Section 1: Main content area -->
    <section class="section section-feed glass-section">
      @if (activeView() === 'feed') {
        <!-- Feed View -->
        <div class="feed-view fade-in">
           <!-- Admin Add Buttons for Feed -->
           @if (isAdmin()) {
             <app-admin-actions 
               [currentFilter]="activeFilter()"
               (create)="openModal($any($event), 'create')" 
              />
           }

          <div class="feed-grid">
            @for (item of paginatedItems(); track item.index) {
              <app-feed-card 
                [item]="item"
                [isAdmin]="isAdmin()"
                (edit)="openModal(item._type === 'projects' ? 'project' : (item._type === 'blog' ? 'blog' : (item._type === 'experience' ? 'experience' : 'studies')), 'edit', item)"
                (delete)="onDelete(item._type === 'projects' ? 'project' : (item._type === 'blog' ? 'blog' : (item._type === 'experience' ? 'experience' : 'studies')), item)"
                (view)="openModal(item._type === 'projects' ? 'project' : (item._type === 'blog' ? 'blog' : (item._type === 'experience' ? 'experience' : 'studies')), 'view', item)"
              />
            } @empty {
              <div class="empty-state">
                <svg class="empty-state__icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"/>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                <p>No se encontraron resultados</p>
              </div>
            }
          </div>

          <!-- Pagination Controls -->
          @if (totalPages() > 1) {
            <div class="pagination-bar">
              <button class="pagination-arrow"
                [disabled]="currentPage() === 0"
                (click)="prevPage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="15 18 9 12 15 6"/>
                </svg>
              </button>

              <div class="pagination-dots">
                @for (page of pageNumbers(); track page) {
                  <button class="pagination-dot"
                    [class.pagination-dot--active]="page === currentPage()"
                    (click)="goToPage(page)">
                  </button>
                }
              </div>

              <button class="pagination-arrow"
                [disabled]="currentPage() === totalPages() - 1"
                (click)="nextPage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              </button>
            </div>
          }
        </div>
      } @else {
        <!-- Contact View -->
        <app-contact-form (backClick)="goToFeed()" />
      }
    </section>

    <!-- Section 5: Skills & Certificates - Right sidebar with auto-rotation -->
    <section class="section section-sidebar glass-section">
      <!-- Tab buttons -->
      <div style="display:flex; gap:0; border-bottom:1px solid rgba(255,255,255,0.06); flex-shrink:0;">
        <button
          style="flex:1; padding:0.6rem 0; background:transparent; border:none; cursor:pointer; font-family:'Architects Daughter',cursive; font-size:0.85rem; letter-spacing:0.05em; transition:all 0.3s ease; display:flex; align-items:center; justify-content:center; gap:6px;"
          [style.color]="sidebarTab() === 'skills' ? '#74b9ff' : '#9ca3af'"
          [style.border-bottom]="sidebarTab() === 'skills' ? '2px solid #74b9ff' : '2px solid transparent'"
          (click)="setSidebarTab('skills')">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
          </svg>
          Skills
        </button>
        <button
          style="flex:1; padding:0.6rem 0; background:transparent; border:none; cursor:pointer; font-family:'Architects Daughter',cursive; font-size:0.85rem; letter-spacing:0.05em; transition:all 0.3s ease; display:flex; align-items:center; justify-content:center; gap:6px;"
          [style.color]="sidebarTab() === 'certificates' ? '#74b9ff' : '#9ca3af'"
          [style.border-bottom]="sidebarTab() === 'certificates' ? '2px solid #74b9ff' : '2px solid transparent'"
          (click)="setSidebarTab('certificates')">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
          </svg>
          Certificados
        </button>
      </div>

       <!-- Admin Add Buttons for Sidebar -->
       <!-- Admin Add Buttons for Sidebar -->
       @if (isAdmin()) {
         <app-admin-actions 
           [currentFilter]="sidebarTab()"
           (create)="openModal($any($event), 'create')" 
          />
       }

      <!-- Tab content -->
      <div class="sidebar-scroll dark-scrollbar">
        @if (sidebarTab() === 'skills') {
          <div class="sidebar-group fade-in-tab"
               cdkDropList
               [cdkDropListData]="skills()"
               [cdkDropListDisabled]="!isAdmin()"
               (cdkDropListDropped)="drop($event, 'skills')">
            @for (skill of skills(); track skill._id || skill.id || $index) {
              <app-skill-card 
                [skill]="skill" 
                cdkDrag
                [isAdmin]="isAdmin()"
                (edit)="openModal('skill', 'edit', skill)"
                (delete)="onDelete('skill', skill)"
              />
            }
          </div>
        } @else {
          <div class="sidebar-group fade-in-tab"
               cdkDropList
               [cdkDropListData]="certificates()"
               [cdkDropListDisabled]="!isAdmin()"
               (cdkDropListDropped)="drop($event, 'certificates')">
            @for (cert of certificates(); track cert._id || cert.id || $index) {
              <app-certificate-card 
                [cert]="cert" 
                cdkDrag
                 [isAdmin]="isAdmin()"
                (edit)="openModal('certificate', 'edit', cert)"
                (delete)="onDelete('certificate', cert)"
              />
            }
          </div>
        }
      </div>
    </section>
  </div>
  
  <!-- DETAIL MODAL -->
  @if (isModalOpen()) {
    <app-detail-modal
        [type]="modalType()"
        [mode]="modalMode()"
        [item]="selectedItem()"
        (close)="closeModal()"
        (saveItem)="onSaveItem($event)"
    />
  }
</div>
