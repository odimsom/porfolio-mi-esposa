<article class="feed-card glass-card">
  <!-- Image section — TOP -->
  <div class="feed-card__image" (click)="view.emit()">
    @if (allImages().length > 0) {
      @for (img of allImages(); track img; let i = $index) {
        <img
          [src]="img"
          [alt]="item().Title"
          class="carousel-img"
          [class.carousel-img--active]="i === currentImageIndex()"
          loading="lazy"
        />
      }
    } @else {
      <div class="feed-card__placeholder" [class]="'feed-card__placeholder--' + item()._type">
        <div class="feed-card__placeholder-icon">
          @if (item()._type === 'experience') {
            <svg
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <rect x="2" y="7" width="20" height="14" rx="2" />
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
            </svg>
          } @else if (item()._type === 'studies') {
            <svg
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
              <path d="M6 12v5c0 1.66 2.69 3 6 3s6-1.34 6-3v-5" />
            </svg>
          } @else {
            <svg
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path
                d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
              />
            </svg>
          }
        </div>
      </div>
    }

    @if (isCurrent()) {
      <div class="feed-card__current-overlay">
        <span class="feed-card__pulse"></span>
        Actual
      </div>
    }

    <!-- View Details Overlay -->
    <div class="view-overlay">
      <span>Ver Detalles</span>
    </div>
  </div>

  <!-- Content section — BOTTOM -->
  <div class="feed-card__body">
    <div class="header-row">
      <div class="feed-card__badge" [class]="'feed-card__badge--' + item()._type">
        @if (item()._type === 'blog') {
          <svg
            width="11"
            height="11"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
          </svg>
        } @else if (item()._type === 'experience') {
          <svg
            width="11"
            height="11"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="2" y="7" width="20" height="14" rx="2" />
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
          </svg>
        } @else if (item()._type === 'projects') {
          <svg
            width="11"
            height="11"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
          </svg>
        } @else {
          <svg
            width="11"
            height="11"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
            <path d="M6 12v5c0 1.66 2.69 3 6 3s6-1.34 6-3v-5" />
          </svg>
        }
        <span>{{ badgeLabel() }}</span>
      </div>

      @if (isAdmin()) {
        <div class="admin-actions">
          <button (click)="edit.emit()" class="action-btn edit" title="Editar">
            <svg
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
            </svg>
          </button>
          <button (click)="delete.emit()" class="action-btn delete" title="Eliminar">
            <svg
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="3 6 5 6 21 6" />
              <path
                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
              />
              <line x1="10" y1="11" x2="10" y2="17" />
              <line x1="14" y1="11" x2="14" y2="17" />
            </svg>
          </button>
        </div>
      }

      <!-- Project Links (Repo/Demo) -->
      @if (item()._type === 'projects') {
        <div class="project-links">
          @if (projectRepo()) {
            <a [href]="projectRepo()" target="_blank" class="project-link" title="Ver Código">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"
                />
              </svg>
            </a>
          }
          @if (projectDemo()) {
            <a [href]="projectDemo()" target="_blank" class="project-link" title="Ver Demo">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10" />
                <polygon points="10 8 16 12 10 16 10 8" />
              </svg>
            </a>
          }
        </div>
      }
    </div>

    <h3 class="feed-card__title">{{ item().Title }}</h3>
    <p class="feed-card__desc">{{ item().Descriptions }}</p>

    <div class="feed-card__meta">
      @if (dateRange()) {
        <span class="feed-card__date">
          <svg
            width="11"
            height="11"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="3" y="4" width="18" height="18" rx="2" />
            <line x1="16" y1="2" x2="16" y2="6" />
            <line x1="8" y1="2" x2="8" y2="6" />
            <line x1="3" y1="10" x2="21" y2="10" />
          </svg>
          {{ dateRange() }}
        </span>
      }
      @if (subtitle()) {
        <span class="feed-card__subtitle">
          <svg
            width="10"
            height="10"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
            <circle cx="12" cy="10" r="3" />
          </svg>
          {{ subtitle() }}
        </span>
      }
    </div>

    <div class="feed-card__labels">
      @for (label of labels(); track label) {
        <span class="chip">{{ label }}</span>
      }
    </div>
  </div>
</article>
