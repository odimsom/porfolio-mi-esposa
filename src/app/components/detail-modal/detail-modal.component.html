<div class="modal-overlay" (click)="close.emit()">
  <div class="modal-container glass-card" (click)="$event.stopPropagation()">
    <!-- Close Button -->
    <button class="close-btn" (click)="close.emit()">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    <!-- Header -->
    <div class="modal-header">
      <h2>
        {{ mode() === 'create' ? 'Nueva' : mode() === 'edit' ? 'Editar' : 'Detalle de' }}
        {{ getEntityLabel() }}
      </h2>
    </div>

    <!-- Form (Create/Edit) -->
    @if (mode() === 'create' || mode() === 'edit') {
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="modal-form">
        <!-- Common Fields -->
        @if (type() !== 'person') {
          <div class="form-group">
            <label>Título / Nombre</label>
            <input type="text" formControlName="Title" placeholder="Ej: Senior Frontend Dev" />
          </div>

          <div class="form-group">
            <label>Descripción</label>
            <textarea
              formControlName="Descriptions"
              rows="4"
              placeholder="Describe los detalles..."
            ></textarea>
          </div>

          <!-- Hidden Index -->
          <input type="hidden" formControlName="index" />
        }

        <!-- Person Fields -->
        @if (type() === 'person') {
          <div class="form-group">
            <label>Nombre Completo</label>
            <input type="text" formControlName="Name" placeholder="Ej: Eva Nazareth" />
          </div>
          <div class="form-group">
            <label>Título Profesional</label>
            <input type="text" formControlName="Title" placeholder="Ej: Frontend Developer" />
          </div>
          <div class="form-group">
            <label>Biografía</label>
            <textarea
              formControlName="Descriptions"
              rows="4"
              placeholder="Breve biografía..."
            ></textarea>
          </div>
          <div class="form-group">
            <label>Foto URL</label>
            <input type="text" formControlName="PhotoUrl" placeholder="https://..." />
          </div>  
          <div class="form-group">
            <label>CV URL</label>
            <input type="text" formControlName="CVUrl" placeholder="https://..." />
          </div>
          <div class="form-row">
            <div class="form-group half">
              <label>Ubicación</label>
              <input type="text" formControlName="Location" placeholder="Ej: Guayaquil, Ecuador" />
            </div>
            <div class="form-group half">
              <label>Email</label>
              <input type="email" formControlName="Email" placeholder="correo@ejemplo.com" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group half">
              <label>GitHub URL</label>
              <input type="text" formControlName="Github" placeholder="https://github.com/..." />
            </div>
            <div class="form-group half">
              <label>LinkedIn URL</label>
              <input
                type="text"
                formControlName="Linkedin"
                placeholder="https://linkedin.com/in/..."
              />
            </div>
          </div>
        }

        @if (type() === 'blog') {
          <div class="form-group">
            <label>Tags (separados por coma)</label>
            <input type="text" [formControlName]="'tagsInput'" placeholder="Angular, Design, UI" />
          </div>
          <div class="form-group">
            <label>Imágenes URL (separadas por coma)</label>
            <textarea
              formControlName="imgsInput"
              rows="3"
              placeholder="https://..., https://..."
            ></textarea>
          </div>
          <div class="form-row">
            <div class="form-group half">
              <label>Fecha</label>
              <input type="text" formControlName="Date" placeholder="Ej: Feb 2024" />
            </div>
            <div class="form-group half">
              <label>Ubicación</label>
              <input type="text" formControlName="Location" placeholder="Ej: Remote" />
            </div>
          </div>
        }

        @if (type() === 'experience' || type() === 'studies' || type() === 'certificate') {
          <div class="form-group">
            <label>{{ type() === 'experience' ? 'Empresa' : 'Universidad / Institución' }}</label>
            <input
              type="text"
              [formControlName]="type() === 'experience' ? 'Company' : 'University'"
              placeholder="Nombre de la institución"
            />
          </div>
          <!-- Date handling -->
          <div class="form-row">
            <div class="form-group half">
              <label>Fecha Inicio</label>
              <input type="text" formControlName="Start" placeholder="Ej: 2020" />
            </div>
            <div class="form-group half">
              <label>Fecha Fin</label>
              <input type="text" formControlName="End" placeholder="Ej: Presente" />
            </div>
          </div>
          <div class="form-group checkbox">
            <label>
              <input type="checkbox" formControlName="isCurrent" />
              Actualmente aquí
            </label>
          </div>
          <div class="form-group">
            <label>Labels/Tech (csv)</label>
            <input type="text" [formControlName]="'tagsInput'" placeholder="React, Node, Mongo" />
          </div>
        }

        @if (type() === 'experience') {
          <div class="form-group">
            <label>Tipo de Trabajo</label>
            <select formControlName="types" multiple class="multi-select">
              @for (type of workTypes; track type) {
                <option [value]="type">{{ type }}</option>
              }
            </select>
            <small>Mantén presionado Ctrl para seleccionar varios</small>
          </div>
        }

        @if (type() === 'project') {
          <div class="form-group">
            <label>Labels/Tech (csv)</label>
            <input type="text" [formControlName]="'tagsInput'" placeholder="React, Node, Mongo" />
          </div>
          <div class="form-group">
            <label>Imágenes URL (separadas por coma)</label>
            <textarea
              formControlName="imgsInput"
              rows="3"
              placeholder="https://..., https://..."
            ></textarea>
          </div>
          <div class="form-group">
            <label>Project URL</label>
            <input type="text" formControlName="Demo" placeholder="https://..." />
          </div>
          <div class="form-group">
            <label>Repository URL</label>
            <input type="text" formControlName="Repository" placeholder="https://github.com/..." />
          </div>
          <div class="form-group">
            <label>Status</label>
            <select formControlName="Status">
              @for (status of projectStatuses; track status) {
                <option [value]="status">{{ status }}</option>
              }
            </select>
          </div>
        }

        @if (type() === 'skill') {
          <div class="form-group">
            <label>Icono (SVG Path o URL)</label>
            <input type="text" formControlName="Icon" placeholder="SVG path d='...'" />
          </div>
          <div class="form-group">
            <label>Tipo</label>
            <select formControlName="Type">
              @for (type of skillTypes; track type) {
                <option [value]="type">{{ type }}</option>
              }
            </select>
          </div>
        }

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="close.emit()">Cancelar</button>
          <button type="submit" class="btn-save" [disabled]="form.invalid">Guardar</button>
        </div>
      </form>
    }

    <!-- View Mode -->
    @else {
      <div class="view-content">
        <!-- Render view content based on type (simplified for now) -->
        <h3>{{ item()?.Title || item()?.Name }}</h3>
        <p class="view-desc">{{ item()?.Descriptions }}</p>

        <!-- Add more specific view details if needed -->
      </div>
    }
  </div>
</div>
